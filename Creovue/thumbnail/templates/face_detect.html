<!--Creovue/thumbnail/templates/face_detect.html -->
{% extends 'dashboard_base.html' %}

{% block title %}Face Detection | Creovue{% endblock %}

{% block styles %}
{{ super() }}
<style>
  .dropzone {
    border: 2px dashed #ccc;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.3s;
  }
  .dropzone.dragover {
    background: #e9ecef;
  }
  .preview-img {
    max-width: 100%;
    margin-top: 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
  }
</style>
{% endblock %}

{% block dashboard_main %}
<!-- Top Bar -->
<header class="topbar">
  <div class="d-flex justify-content-between align-items-center">
    <h1 class="h4 mb-0 text-gray-800"> ðŸ§  Thumbnail Face Detection </h1>
    <div class="d-flex align-items-center">
      <div class="dropdown">
        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
          {% if current_user.profile_pic %}
            <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) }}" alt="Profile" width="32" height="32" class="rounded-circle me-2">
          {% else %}
              <i class="bi bi-person-circle me-1"></i>
              <span class="me-2">{{ current_user.username }}</span>
          {% endif %}
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
          <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</header>


<div class="container-fluid py-4">

  <div class="card metric-card h-100 p-4">
    <form method="POST" enctype="multipart/form-data"  class="mb-5 p-4 border rounded bg-light shadow-sm responsive" id="upload-form">
      <div id="dropzone" class="dropzone mb-3">
        <input type="file" name="thumbnail" id="thumbnail" accept="image/*" hidden required>
        <p>ðŸ“‚ Drag & drop your image here or click to select</p>
        <img id="preview" class="preview-img" style="display: none;" alt="Image Preview">
      </div>
      <button class="btn btn-primary" type="submit">Analyse</button>
    </form>
  </div>

  {% if image_url %}
    <div class="alert alert-info">Faces Detected: {{ faces_count }}</div>
    <img src="{{ image_url }}" alt="Detected Faces" class="img-fluid rounded border">
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  const dropzone = document.getElementById('dropzone');
  const fileInput = document.getElementById('thumbnail');
  const preview = document.getElementById('preview');

  dropzone.addEventListener('click', () => fileInput.click());

  dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('dragover');
  });

  dropzone.addEventListener('dragleave', () => {
    dropzone.classList.remove('dragover');
  });

  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      fileInput.files = files;
      showPreview(files[0]);
    }
  });

  fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
      showPreview(fileInput.files[0]);
    }
  });

  function showPreview(file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      preview.src = e.target.result;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
</script>
{% endblock %}
