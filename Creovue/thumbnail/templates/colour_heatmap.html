<!-- Creovue/thumbnail_eval/templates/colour_heatmap.html -->
{% extends 'dashboard_base.html' %}

{% block title %}Colour Heatmap | Creovue{% endblock %}

{% block dashboard_main %}
<!-- Top Bar -->
<header class="topbar">
  <div class="d-flex justify-content-between align-items-center">
    <h1 class="h4 mb-0 text-gray-800"> ðŸŽ¨ Thumbnail Colour Heatmap</h1>
    <div class="d-flex align-items-center">
      <div class="dropdown">
        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
          {% if current_user.profile_pic %}
            <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) }}" alt="Profile" width="32" height="32" class="rounded-circle me-2">
          {% else %}
              <i class="bi bi-person-circle me-1"></i>
              <span class="me-2">{{ current_user.username }}</span>
          {% endif %}
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
          <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</header>


<div class="container-fluid py-4">

  <div class="card metric-card h-100 p-4">
    <form id="upload-form" method="POST" enctype="multipart/form-data" class="dropzone-area border p-4 mb-3" style="text-align:center">
      <p>ðŸ“‚ Drag & drop or click to upload a thumbnail</p>
      <input type="file" name="thumbnail" id="file-input" accept="image/*" hidden onchange="previewImage(this)">
      <button type="button" class="btn btn-secondary" onclick="document.getElementById('file-input').click()">Choose File</button>
      <button type="submit" class="btn btn-primary mt-2">Generate Heatmap</button>
    </form>
  </div>

  <div class="row mt-4">
    {% if image_url %}
    <div class="col-md-6">
      <h5>ðŸ“· Original Image</h5>
      <img src="{{ image_url }}" class="img-fluid border rounded">
    </div>
    {% endif %}
    {% if heatmap_url %}
    <div class="col-md-6">
      <h5>ðŸ”¥ Heatmap</h5>
      <img src="{{ heatmap_url }}" class="img-fluid border rounded">
    </div>
    {% endif %}
  </div>
</div>

<script>
function previewImage(input) {
  const file = input.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const img = document.createElement("img");
      img.src = e.target.result;
      img.className = "img-fluid border rounded my-2";
      const previewDiv = document.querySelector(".dropzone-area");
      previewDiv.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
}
</script>
{% endblock %}
