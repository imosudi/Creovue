<!-- Creovue/thumbnail/templates/text_density.html -->
{% extends 'dashboard_base.html' %}

{% block title %}Text Density | Creovue{% endblock %}

{% block styles %}
{{ super() }}
<style>
  .dropzone {
    border: 2px dashed #ccc;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.3s;
  }

  .dropzone.dragover {
    background: #e9ecef;
  }

  .progress {
    height: 25px;
  }

  .text-preview {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
    border: 1px solid #ddd;
  }

  .result-section {
    margin-top: 30px;
  }
</style>
{% endblock %}

{% block dashboard_main %}
<!-- Top Bar -->
<header class="topbar">
  <div class="d-flex justify-content-between align-items-center">
    <h1 class="h4 mb-0 text-gray-800"> 🔠 Thumbnail Text Density Analysis </h1>
    <div class="d-flex align-items-center">
      <div class="dropdown">
        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
          {% if current_user.profile_pic %}
            <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) }}" alt="Profile" width="32" height="32" class="rounded-circle me-2">
          {% else %}
              <i class="bi bi-person-circle me-1"></i>
              <span class="me-2">{{ current_user.username }}</span>
          {% endif %}
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
          <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</header>


<div class="container-fluid py-4">
  <div class="card metric-card h-100 p-4">
    <form method="POST" enctype="multipart/form-data"  class="mb-5 p-4 border rounded bg-light shadow-sm" id="upload-form">
      <div id="dropzone" class="dropzone mb-3">
        <input type="file" name="thumbnail" id="thumbnail" accept="image/*" hidden required>
        <p>📂 Drag & drop your thumbnail here or click to select</p>
      </div>
      <button class="btn btn-primary" type="submit">Analyse</button>
    </form>
  </div>
  {% if image_url %}
  <div class="result-section">
    <h5>🧮 Text Count: <strong>{{ text_count }}</strong></h5>

    {% if recommendation %}
      <div class="alert alert-warning">{{ recommendation }}</div>
    {% endif %}

    <div class="mb-4">
      <h6 class="mb-2">📊 Estimated Text Coverage</h6>
      <div class="progress">
        <div class="progress-bar 
          {% if text_count == 0 %}bg-secondary
          {% elif text_count > 20 %}bg-danger
          {% else %}bg-success{% endif %}"
          role="progressbar"
          style="width: {{ (text_count * 5) if text_count <= 20 else 100 }}%;"
          aria-valuenow="{{ text_count }}"
          aria-valuemin="0"
          aria-valuemax="100">
          {{ (text_count * 5) if text_count <= 20 else 100 }}%
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <h6>🖼️ Original</h6>
        <img src="{{ image_url }}" class="text-preview">
      </div>
      <div class="col-md-6">
        <h6>🔍 Overlay</h6>
        <img src="{{ overlay_url }}" class="text-preview">
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  // Drag-and-drop logic
  const dropzone = document.getElementById('dropzone');
  const fileInput = document.getElementById('thumbnail');

  dropzone.addEventListener('click', () => fileInput.click());

  dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('dragover');
  });

  dropzone.addEventListener('dragleave', () => {
    dropzone.classList.remove('dragover');
  });

  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    fileInput.files = e.dataTransfer.files;
  });
</script>
{% endblock %}
