<!-- Creovue/thumbnail/templates/summary.html -->

{% extends 'dashboard_base.html' %}

{% block title %}Thumbnail Evaluation Summary | Creovue{% endblock %}

{% block styles %}
{{ super() }}
<style>
  .summary-card {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 25px;
  }
  .summary-header {
    font-weight: bold;
    font-size: 1.25rem;
    color: #3e6fbd;
    margin-bottom: 10px;
  }
  .metric-badge {
    font-size: 0.95rem;
    padding: 4px 10px;
    border-radius: 20px;
    margin-right: 6px;
  }
  .recommendation {
    font-size: 0.95rem;
    padding: 8px 12px;
    border-radius: 6px;
    background-color: #f8f9fa;
    margin-top: 8px;
  }
  .overlay-image {
    max-width: 100%;
    border: 1px solid #ccc;
    border-radius: 8px;
  }
  pre.code-block {
    background-color: #f5f5f5;
    border: 1px solid #ddd;
    padding: 16px;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 0.9rem;
  }
</style>
{% endblock %}

{% block dashboard_main %}
<!-- Top Bar -->
<header class="topbar">
  <div class="d-flex justify-content-between align-items-center">
    <h1 class="h4 mb-0 text-gray-800"> ðŸ“Š Thumbnail Evaluation Summary</h1>
    <div class="d-flex align-items-center">
      <div class="dropdown">
        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
          {% if current_user.profile_pic %}
            <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) }}" alt="Profile" width="32" height="32" class="rounded-circle me-2">
          {% else %}
              <i class="bi bi-person-circle me-1"></i>
              <span class="me-2">{{ current_user.username }}</span>
          {% endif %}
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
          <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</header>


<div class="container-fluid py-4">
  <div class="card metric-card h-100 p-4">
  <!-- Upload Form -->
  <form method="POST" enctype="multipart/form-data" class="mb-5 p-4 border rounded bg-light shadow-sm">
    <div class="mb-3">
      <label for="thumbnail" class="form-label fw-semibold">Upload Thumbnail Image</label>
      <input type="file" name="thumbnail" id="thumbnail" accept="image/*" class="form-control" required>
    </div>
    <button type="submit" class="btn btn-primary">
      <i class="bi bi-lightning-charge"></i> Evaluate Thumbnail
    </button>
  </form>
  </div>
  {% if image_url %}
  <div class="row">
    <div class="col-lg-6">
      <div class="summary-card">
        <div class="summary-header">ðŸ‘¤ Face Detection</div>
        <p>Faces Detected: <strong>{{ face_count }}</strong></p>
        {% if face_image_url %}
          <img src="{{ face_image_url }}" class="overlay-image" alt="Face Detection Result">
        {% endif %}
      </div>
    </div>

    <div class="col-lg-6">
      <div class="summary-card">
        <div class="summary-header">ðŸŽ¨ Colour Heatmap</div>
        {% if heatmap_url %}
          <img src="{{ heatmap_url }}" class="overlay-image" alt="Heatmap">
        {% endif %}
      </div>
    </div>

    <div class="col-lg-6">
      <div class="summary-card">
        <div class="summary-header">ðŸ”  Text Detection</div>
        <p>Text Count: <strong>{{ text_count }}</strong></p>
        <p>Density: <strong>{{ (text_ratio | default(0)) | round(2) * 100 }}%</strong></p>
        {% if text_overlay_url %}
          <img src="{{ text_overlay_url }}" class="overlay-image" alt="Text Overlay">
        {% endif %}
        <div class="recommendation mt-2">{{ text_recommendation }}</div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="summary-card">
        <div class="summary-header">ðŸ“ˆ CTR Prediction</div>
        <h4 class="text-success">Predicted CTR Score: {{ ctr_score }}/10</h4>
        <ul class="list-group mt-3">
          {% for item in ctr_feedback %}
            <li class="list-group-item small">{{ item }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Collapsible JSON Export -->
  <div class="mt-5">
    <button class="btn btn-outline-secondary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#jsonExport" aria-expanded="false" aria-controls="jsonExport">
      <i class="bi bi-code-slash"></i> Toggle JSON Export
    </button>
    <div class="collapse" id="jsonExport">
      <div class="card card-body bg-light">
        <pre class="code-block">{{ {
            "image_url": image_url or "",
            "face_count": face_count or 0,
            "text_count": text_count or 0,
            "text_ratio": (text_ratio | default(0)) | round(4),
            "text_recommendation": text_recommendation or "",
            "ctr_score": ctr_score or 0,
            "ctr_feedback": ctr_feedback or [],
            "overlay_urls": {
              "face": face_image_url or "",
              "heatmap": heatmap_url or "",
              "text": text_overlay_url or ""
            }
          } | tojson(indent=2) }}</pre>
          
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
