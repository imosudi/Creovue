{% extends "base.html" %}
{% block title %}YouTube Dashboard | Creovue{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold">üé• Linked YouTube Channel Overview</h2>
        <p class="text-muted">These insights reflect the current status of your connected YouTube channel.</p>
    </div>

    {% if data.get('items') %}
        {% for channel in data.get('items', []) %}
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <img src="{{ channel.snippet.thumbnails.default.url }}" alt="Channel Logo"
                         class="me-3 rounded-circle" width="60" height="60">
                    <div>
                        <h4 class="mb-0">{{ channel.snippet.title }}</h4>
                        <small class="text-muted">
                            {{ channel.snippet.description[:100] }}{% if channel.snippet.description|length > 100 %}...{% endif %}
                        </small>
                    </div>
                </div>

                <div class="row text-center">
                    <div class="col-md-4">
                        <h6>Total Views</h6>
                        <p class="fw-bold text-primary">{{ channel.statistics.viewCount | format_number }}</p>
                    </div>
                    <div class="col-md-4">
                        <h6>Subscribers</h6>
                        <p class="fw-bold text-success">{{ channel.statistics.subscriberCount | format_number }}</p>
                    </div>
                    <div class="col-md-4">
                        <h6>Total Videos</h6>
                        <p class="fw-bold text-info">{{ channel.statistics.videoCount | format_number }}</p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-warning text-center">
            <strong>No channel data found.</strong> Please link your YouTube account.
        </div>
    {% endif %}

    <!-- Chart Section -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">üìà Subscriber Growth (Past 7 Days)</h5>
        </div>
        <div class="card-body">
            <canvas id="subscribersChart" height="100"></canvas>
        </div>
    </div>

    <div class="card shadow-sm mb-5">
        <div class="card-header">
            <h5 class="mb-0">üî• Top Videos by Views</h5>
        </div>
        <div class="card-body">
            <canvas id="topVideosChart" height="100"></canvas>
        </div>
    </div>

    <div class="text-center">
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary">‚Üê Back to Dashboard</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Mock data - Replace with actual from Flask if integrated
    /*const subscriberLabels = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
    const subscriberData = [100, 120, 130, 150, 160, 180, 200];

    const topVideoLabels = ["Intro to AI", "Flask Tutorial", "YouTube SEO", "Thumbnail Tricks", "Creator Tools"];
    const topVideoViews = [1200, 950, 840, 720, 600];*/

    const subscriberLabels = {{ subscriber_labels | tojson }};
    const subscriberData = {{ subscriber_trend | tojson }};

    const topVideoLabels = {{ top_videos | map(attribute='title') | list | tojson }};
    const topVideoViews = {{ top_videos | map(attribute='views') | list | tojson }};


    new Chart(document.getElementById("subscribersChart").getContext("2d"), {
        type: 'line',
        data: {
            labels: subscriberLabels,
            datasets: [{
                label: 'Subscribers',
                data: subscriberData,
                borderColor: '#36a2eb',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: { display: false },
                legend: { display: false }
            }
        }
    });

    new Chart(document.getElementById("topVideosChart").getContext("2d"), {
        type: 'bar',
        data: {
            labels: topVideoLabels,
            datasets: [{
                label: 'Views',
                data: topVideoViews,
                backgroundColor: '#ff6384'
            }]
        },
        options: {
            indexAxis: 'y',
            plugins: {
                title: { display: false },
                legend: { display: false }
            }
        }
    });
</script>
{% endblock %}
